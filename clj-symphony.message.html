<!DOCTYPE html PUBLIC ""
    "">
<html><head><meta charset="UTF-8" /><title>clj-symphony.message documentation</title><link rel="stylesheet" type="text/css" href="css/default.css" /><link rel="stylesheet" type="text/css" href="css/highlight.css" /><script type="text/javascript" src="js/highlight.min.js"></script><script type="text/javascript" src="js/jquery.min.js"></script><script type="text/javascript" src="js/page_effects.js"></script><script>hljs.initHighlightingOnLoad();</script></head><body><div id="header"><h2>Generated by <a href="https://github.com/weavejester/codox">Codox</a></h2><h1><a href="index.html"><span class="project-title"><span class="project-name">Clj-symphony</span> <span class="project-version">0.8.0-SNAPSHOT</span></span></a></h1></div><div class="sidebar primary"><h3 class="no-link"><span class="inner">Project</span></h3><ul class="index-link"><li class="depth-1 "><a href="index.html"><div class="inner">Index</div></a></li></ul><h3 class="no-link"><span class="inner">Namespaces</span></h3><ul><li class="depth-1"><div class="no-link"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>clj-symphony</span></div></div></li><li class="depth-2 branch"><a href="clj-symphony.chat.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>chat</span></div></a></li><li class="depth-2 branch"><a href="clj-symphony.connect.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>connect</span></div></a></li><li class="depth-2 branch current"><a href="clj-symphony.message.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>message</span></div></a></li><li class="depth-2 branch"><a href="clj-symphony.room.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>room</span></div></a></li><li class="depth-2 branch"><a href="clj-symphony.stream.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>stream</span></div></a></li><li class="depth-2 branch"><a href="clj-symphony.user.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>user</span></div></a></li><li class="depth-2"><a href="clj-symphony.user-connection.html"><div class="inner"><span class="tree"><span class="top"></span><span class="bottom"></span></span><span>user-connection</span></div></a></li></ul></div><div class="sidebar secondary"><h3><a href="#top"><span class="inner">Public Vars</span></a></h3><ul><li class="depth-1"><a href="clj-symphony.message.html#var-deregister-listener.21"><div class="inner"><span>deregister-listener!</span></div></a></li><li class="depth-1"><a href="clj-symphony.message.html#var-entity-ids"><div class="inner"><span>entity-ids</span></div></a></li><li class="depth-1"><a href="clj-symphony.message.html#var-escape"><div class="inner"><span>escape</span></div></a></li><li class="depth-1"><a href="clj-symphony.message.html#var-mentions"><div class="inner"><span>mentions</span></div></a></li><li class="depth-1"><a href="clj-symphony.message.html#var-msgobj-.3Emap"><div class="inner"><span>msgobj-&gt;map</span></div></a></li><li class="depth-1"><a href="clj-symphony.message.html#var-register-listener.21"><div class="inner"><span>register-listener!</span></div></a></li><li class="depth-1"><a href="clj-symphony.message.html#var-sanitise-tag"><div class="inner"><span>sanitise-tag</span></div></a></li><li class="depth-1"><a href="clj-symphony.message.html#var-sanitize-tag"><div class="inner"><span>sanitize-tag</span></div></a></li><li class="depth-1"><a href="clj-symphony.message.html#var-send-message.21"><div class="inner"><span>send-message!</span></div></a></li><li class="depth-1"><a href="clj-symphony.message.html#var-to-plain-text"><div class="inner"><span>to-plain-text</span></div></a></li><li class="depth-1"><a href="clj-symphony.message.html#var-tokens"><div class="inner"><span>tokens</span></div></a></li></ul></div><div class="namespace-docs" id="content"><h1 class="anchor" id="top">clj-symphony.message</h1><div class="doc"><div class="markdown"><p>Operations related to MessageMLv2 messages, which combine one or more of:</p>
<ol>
  <li>a human-readable message (formatted using a subset of HTML called ‘PresentationML’)</li>
  <li>a machine readable JSON blob called the ‘entity data’</li>
  <li>an attachment</li>
</ol>
<p>See:</p>
<ul>
  <li><a href="https://rest-api.symphony.com/docs/messagemlv2">https://rest-api.symphony.com/docs/messagemlv2</a> for details on PresentationML’s formatting capabilities</li>
  <li><a href="https://rest-api.symphony.com/docs/objects">https://rest-api.symphony.com/docs/objects</a> for details on MessageMLv2’s entity data capabilities</li>
</ul></div></div><div class="public anchor" id="var-deregister-listener.21"><h3>deregister-listener!</h3><div class="usage"><code>(deregister-listener! c l)</code></div><div class="doc"><div class="markdown"><p>Deregisters a previously-registered message listener. Once deregistered, a listener should be discarded (they cannot be reused). Returns <code>true</code> if a valid message listener was deregistered, <code>false</code> otherwise.</p></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L248">view source</a></div></div><div class="public anchor" id="var-entity-ids"><h3>entity-ids</h3><div class="usage"><code>(entity-ids text)</code></div><div class="doc"><div class="markdown"><p>Returns an ordered sequence of all entity ids found in the given PresentationML.</p></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L84">view source</a></div></div><div class="public anchor" id="var-escape"><h3>escape</h3><div class="usage"><code>(escape s)</code></div><div class="doc"><div class="markdown"><p>Escapes the given string as content in a MessageMLv2 message.</p></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L155">view source</a></div></div><div class="public anchor" id="var-mentions"><h3>mentions</h3><h4 class="type">multimethod</h4><div class="usage"><code>(mentions m)</code></div><div class="doc"><div class="markdown"><p>Returns the list of user ids mentioned in the message (or nil if there aren’t any). Note that due to a bug in Symphony, @mentions of cross-pod users that the author of the message isn’t connected to will be missing from the result.</p></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L93">view source</a></div></div><div class="public anchor" id="var-msgobj-.3Emap"><h3>msgobj-&gt;map</h3><div class="usage"><code>(msgobj-&gt;map m)</code></div><div class="doc"><div class="markdown"><p>Converts a <code>org.symphonyoss.symphony.clients.model.SymMessage</code> object into a map with these keys:</p>
<table>
  <thead>
    <tr>
      <th>Key </th>
      <th>Description </th>
    </tr>
  </thead>
  <tbody>
    <tr>
      <td><code>:message-id</code> </td>
      <td>The id of the message. </td>
    </tr>
    <tr>
      <td><code>:timestamp</code> </td>
      <td>The timestamp of the message. </td>
    </tr>
    <tr>
      <td><code>:stream-id</code> </td>
      <td>The stream id of the stream the message was sent to. </td>
    </tr>
    <tr>
      <td><code>:user-id</code> </td>
      <td>The user id of the user who sent the message. </td>
    </tr>
    <tr>
      <td><code>:type</code> </td>
      <td>The ‘type’ of the message. <em>(seems to be unused??)</em> </td>
    </tr>
    <tr>
      <td><code>:text</code> </td>
      <td>The PresentationML ‘text’ of the message. </td>
    </tr>
    <tr>
      <td><code>:attachment</code> </td>
      <td>The attachment for the message (if any). </td>
    </tr>
    <tr>
      <td><code>:entity-data</code> </td>
      <td>The parsed JSON ‘entity data’ for the message as a map (if any). </td>
    </tr>
  </tbody>
</table></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L55">view source</a></div></div><div class="public anchor" id="var-register-listener.21"><h3>register-listener!</h3><div class="usage"><code>(register-listener! c f)</code></div><div class="doc"><div class="markdown"><p>Registers f, a function with 1 parameter, as a message listener (callback), and returns a handle to that listener so that it can be deregistered later on, if needed. Listeners registered in this manner are not scoped to any particular stream - they will be sent all messages from all streams that the authenticated connection user is a participant in.</p>
<p>The argument passed to f is a map generated by <a href="clj-symphony.message.html#var-msgobj-.3Emap">msgobj-&gt;map</a>.</p>
<p>The value returned by f (if any) is ignored.</p></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L229">view source</a></div></div><div class="public anchor" id="var-sanitise-tag"><h3>sanitise-tag</h3><div class="usage"><code>(sanitise-tag s)</code></div><div class="doc"><div class="markdown"><p>Sanitises the given string for use in a Symphony hashtag or cashtag.</p></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L162">view source</a></div></div><div class="public anchor" id="var-sanitize-tag"><h3>sanitize-tag</h3><div class="usage"></div><div class="doc"><div class="markdown"><p>English (simplified) version of sanitise-tag. See that fn for details.</p></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L166">view source</a></div></div><div class="public anchor" id="var-send-message.21"><h3>send-message!</h3><div class="usage"><code>(send-message! c s m)</code><code>(send-message! c s m ed)</code><code>(send-message! c s m ed a)</code></div><div class="doc"><div class="markdown"><p>Sends a message to the stream <code>s</code> (which can be anything supported by <a href="clj-symphony.stream.html#var-stream-id">clj-symphony.stream/stream-id</a>).</p>
<ul>
  <li><code>m</code> is a String containing MessageMLv2</li>
  <li><code>ed</code> is a map or a JSON String containing entity data (a map will be converted to a String)</li>
  <li><code>a</code> is an attachment (something compatible with <a href="https://clojure.github.io/clojure/clojure.java.io-api.html">clojure.java.io/file</a>)</li>
</ul></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L203">view source</a></div></div><div class="public anchor" id="var-to-plain-text"><h3>to-plain-text</h3><div class="usage"><code>(to-plain-text text)</code></div><div class="doc"><div class="markdown"><p>Converts a MessageML message to plain text, by stripping most tags, converting <code>&lt;p&gt;</code> and <code>&lt;br/&gt;</code> tags into newlines, and unescaping HTML entities into their Unicode equivalents.</p></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L171">view source</a></div></div><div class="public anchor" id="var-tokens"><h3>tokens</h3><div class="usage"><code>(tokens m)</code></div><div class="doc"><div class="markdown"><p>Returns the tokens (words) in the given MessageML message, in all lower case. Splits on whitespace and punctuation (via the Java regex pattern <code>[\p{Punct}\s]+</code>). Note that message content that contains whitespace within a single tag will also be split - this is especially noticable for @mentions containing a person’s first and last names.</p></div></div><div class="src-link"><a href="https://github.com/symphonyoss/clj-symphony/blob/master/src/clj_symphony/message.clj#L194">view source</a></div></div></div></body></html>